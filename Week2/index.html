<html>
	<head>
		<link rel="icon" type="image/png"  href="data/icon256.ico">
		<title>3d Rendering</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="http://threejs.org/build/three.min.js"></script>
	

		

		<script id="flat_shaded" type="x-shader/x-fragment">
			uniform vec3 fcolor;                  // <- face color passed from application 
			void main( void ) {    
				gl_FragColor = vec4(fcolor,1.0);  // <- set color passed to framebuffer to facecolor

			}
		</script>

		<script id="vertex_colored" type="x-shader/x-fragment">
			varying vec3 vColor;                  // <--   Interpolated Vertex color passed from Vertex Shader
			void main( void ) {
				gl_FragColor = vec4(vColor,1.0);  // <-- Set output color to Interpolated color

			}
		</script>

		<script id="textured" type="x-shader/x-fragment">
			uniform sampler2D myTexture;                  // < -- Texture passed from application
			varying vec2 vUv;  			                  // < -- UV for this pixel
			void main( void ) {
				gl_FragColor = texture2D(myTexture, vUv); // Read correct pixel from texture and set to output color

			}
		</script>

		<script id="texturedLit" type="x-shader/x-fragment">
			uniform sampler2D myTexture;
			varying vec2 vUv;
			uniform vec3 addedLights;

			void main( void ) {

				gl_FragColor = texture2D(myTexture, vUv) * vec4(addedLights,1);

			}

		</script>


		<script id="vertexShader" type="x-shader/x-vertex">
			varying vec3 vColor ;   // <-- Interpolated Vertex color passed to Fragment Shader
			varying vec2 vUv;       // <-- Interpolated Vertex color passed to Fragment Shader
			void main()
			{
				
				vColor= color;  // <-- Set the veterx vColor vertex color to passed along to the interpolated color
				vUv = uv;       // <-- Set vUV to be passed to intperpolated 
				vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 ); // Do first transformation (future topic)
				gl_Position = projectionMatrix * mvPosition;  // transform to final position on screen(future topic)
			}
		</script>




		<script>


			(function () {
				var scene = new THREE.Scene();
				var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
				var cat;
				var renderer = new THREE.WebGLRenderer();
				scene.background = new THREE.Color( 0x23606b );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );


				//----------------------------------------------------------------
				// Create Triangle Geometry
				//----------------------------------------------------------------
				var geometry = new THREE.Geometry();
				geometry.vertices.push(
					new THREE.Vector3( -1,  1, 0 ),
					new THREE.Vector3( -1, -1, 0 ),
					new THREE.Vector3(  1, -1, 0 )
				);
			
				geometry.faces.push( new THREE.Face3( 0, 1, 2 ) );

				geometry.faces[0].vertexColors[0] = new THREE.Color(0xff0000); // red
				geometry.faces[0].vertexColors[1] = new THREE.Color(0x00ff00); // green
				geometry.faces[0].vertexColors[2] = new THREE.Color(0x0000ff); // blue

				geometry.computeBoundingSphere();


				//----------------------------------------------------------------
				// Create Material for flat shaded
				//----------------------------------------------------------------

				var material = new THREE.ShaderMaterial( {
						vertexShader: document.getElementById( 'vertexShader' ).textContent,
						fragmentShader: document.getElementById( 'flat_shaded' ).textContent
					} );
				material.uniforms = { "fcolor": { value: new THREE.Vector3(0.5,0,0) }};
				material.side = THREE.DoubleSide;
				material.vertexColors = THREE.VertexColors;

				//----------------------------------------------------------------
				// Create Vertex Lit  mesh and add to scene
				//----------------------------------------------------------------

				var triangle_flat_shaded = new THREE.Mesh( geometry, material );
				triangle_flat_shaded.position.y += 2.01;
				triangle_flat_shaded.position.x -= 2.01;
				scene.add(triangle_flat_shaded);
			


				//----------------------------------------------------------------
				// Create Material for Vertex Lit 
				//----------------------------------------------------------------

				var material_vertex_colored = new THREE.ShaderMaterial( {
						vertexShader: document.getElementById( 'vertexShader' ).textContent,
						fragmentShader: document.getElementById( 'vertex_colored' ).textContent
					} );
				material_vertex_colored.side = THREE.DoubleSide;
				material_vertex_colored.vertexColors = THREE.VertexColors;

				//----------------------------------------------------------------
				// Create  mesh for Vertex Lit and add to scene
				//----------------------------------------------------------------

				var triangle_vertex_colored = new THREE.Mesh(geometry, material_vertex_colored );
				console.log(triangle_vertex_colored);
				triangle_vertex_colored.position.y += 2.01;
				triangle_vertex_colored.position.x += 2.01;
				scene.add(triangle_vertex_colored);


				//----------------------------------------------------------------
				// Create Geometry for Quad
				//----------------------------------------------------------------

				var geometry = new THREE.Geometry();
				geometry.vertices.push(
					new THREE.Vector3( -1,  1, 0 ),
					new THREE.Vector3( -1, -1, 0 ),
					new THREE.Vector3(  1, -1, 0 ),
					new THREE.Vector3(  1,  1, 0 )
				);
				 geometry.faceVertexUvs[0].push([
					new THREE.Vector2(0,1),//0
					new THREE.Vector2(0,0),//1
					new THREE.Vector2(1,0),//2
					 ]);
			
				 geometry.faceVertexUvs[0].push([
					new THREE.Vector2(1,0),//2
					new THREE.Vector2(1,1),//3
					new THREE.Vector2(0,1),//1
					 ]);
				geometry.faces.push( new THREE.Face3( 0, 1, 2 , new THREE.Vector3(0,0,1) ));
				geometry.faces.push( new THREE.Face3( 2, 3, 0 , new THREE.Vector3(0,0,1)));

				//----------------------------------------------------------------
				// Create Material for textured quad 
				//----------------------------------------------------------------

				var material_textured = new THREE.ShaderMaterial( {
						vertexShader: document.getElementById( 'vertexShader' ).textContent,
						fragmentShader: document.getElementById( 'textured' ).textContent
					} );
				material_textured.uniforms = { "fcolor": { value: new THREE.Vector3(0,0,0.5) }, 
				   	"myTexture": { value: THREE.ImageUtils.loadTexture("data/cat_low_res.png") } }
				material_textured.side = THREE.DoubleSide;
				material_textured.vertexColors = THREE.VertexColors;

				//----------------------------------------------------------------
				// Create Mesh for textured quad and add to scene 
				//----------------------------------------------------------------
				var quad_textured = new THREE.Mesh( geometry, material_textured );
				quad_textured.position.y -= 2.01;
				quad_textured.position.x -= 2.01;
				scene.add(quad_textured);

				//----------------------------------------------------------------
				// Create Material for textured Lit quad 
				//----------------------------------------------------------------

				var material_texturedLit = new THREE.ShaderMaterial( {
						vertexShader: document.getElementById( 'vertexShader' ).textContent,
						fragmentShader: document.getElementById( 'texturedLit' ).textContent
					} );
				material_texturedLit.uniforms = { "fcolor": { value: new THREE.Vector3(0,0,0.5) }, 
				   	"myTexture": { value: THREE.ImageUtils.loadTexture("data/cat_low_res.png") },
					"addedLights" : { value: new THREE.Vector3(0.2,0.2,0.2) }
			   		}
				material_texturedLit.side = THREE.DoubleSide;
				material_texturedLit.vertexColors = THREE.VertexColors;

				//----------------------------------------------------------------
				// Create Mesh for textured lit quad and add to scene 
				//----------------------------------------------------------------
				var quad_texturedLit = new THREE.Mesh( geometry, material_texturedLit );
				quad_texturedLit.position.y -= 2.01;
				quad_texturedLit.position.x += 2.01;
				scene.add(quad_texturedLit);


				camera.position.z = 5;
				colorIntensity = 1
				var lightColor = new THREE.Vector3(1.2,1.2,0.7); 
				var animate = function () {
					requestAnimationFrame( animate );

					triangle_flat_shaded.rotation.y += 0.01;
					triangle_vertex_colored.rotation.y += 0.01;
					quad_textured.rotation.y += 0.01;
					colorIntensity += 0.005;
					intensity = colorIntensity - Math.floor(colorIntensity);
				material_texturedLit.uniforms.addedLights.value.multiplyVectors( lightColor,new THREE.Vector3(intensity,intensity,intensity)  ); 
					
				//	console.log(material_texturedLit.uniforms.addedLights.value );



					renderer.render( scene, camera );
				};

				
				animate();
			}());


		</script>
	</body>
</html>
