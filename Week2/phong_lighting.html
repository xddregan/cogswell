<html>
	<head>
		<link rel="icon" type="image/png"  href="data/icon256.ico">
		<title>3d Rendering</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="http://threejs.org/build/three.min.js"></script>
	

		




		<script id="lighting_phong" type="x-shader/x-fragment">
			uniform vec3 ambientLight;                  // <- ambient light 
			uniform vec3 lightPosition;
			uniform float specularFactor;
			varying vec3 Normal;
			varying vec3 FragPos;

			const	vec4 specularColor = vec4(1.0,1.0,1.0,1.0);

			void main( void ) {    
				vec3 norm = normalize(Normal);  // this ensure the normal is of lenght 1
				vec3 lightDir = normalize(lightPosition - FragPos); //  subtract the position of pixel from position of light to get direction of light 
				float diffuse = max(dot(norm, lightDir), 0.0); // lightDir . norm is the diffuse calculation
				vec3 reflectionDir = reflect(-lightDir,Normal);  //I - 2.0 * dot(N, I) * N.
				vec3 viewDir = normalize(-FragPos);
				float specular = 0.0;				
				if (diffuse > 0.0)					
				{
					float specAngle = max(dot(reflectionDir,viewDir),0.0);
					specular = pow(specAngle,specularFactor);
				}

				gl_FragColor = (specularColor * specular) +  diffuse * vec4(ambientLight,1.0);  // <- set color passed to framebuffer to facecolor

			}
		</script>


		<script id="vertexShader_phong" type="x-shader/x-vertex">
			varying vec3 Normal;
			varying vec3 FragPos;
			void main()
			{
					
				vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 ); // Do first transformation (future topic)
				gl_Position = projectionMatrix * mvPosition;  // transform to final position on screen(future topic)
				Normal = normalMatrix * normal;
				FragPos = vec3(modelViewMatrix * vec4(position,1.0));

			}
		</script>




		<script>


			function init () {
				var scene = new THREE.Scene();
				var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

				var cat;
				var renderer = new THREE.WebGLRenderer();
				scene.background = new THREE.Color( 0x23606b );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				var geometry = new THREE.SphereGeometry(1,40,40);

				//----------------------------------------------------------------
				// Create diffuse light 
				//----------------------------------------------------------------

				var material_phong = new THREE.ShaderMaterial( {
						vertexShader: document.getElementById( 'vertexShader_phong' ).textContent,
						fragmentShader: document.getElementById( 'lighting_phong' ).textContent
					} );
				material_phong.uniforms = { 
						"ambientLight": { value: new THREE.Vector3(0.5,0.3,0.1) },
						"lightPosition": { value: new THREE.Vector3(5.5,5.5,4) },
						"specularFactor": { value: 22.0 }
				};

				material_phong.side = THREE.DoubleSide;


				//----------------------------------------------------------------
				// Create flat Lit  mesh and add to scene
				//----------------------------------------------------------------

				var test_sphere = new THREE.Mesh( geometry, material_phong );

				//var helper = new THREE.FaceNormalsHelper( test_sphere, 0.25, 0x00ff00, 1 );
				scene.add(test_sphere);
				//scene.add(helper);

			


				camera.position.z = 5;
				var animate = function () {
					requestAnimationFrame( animate );

					test_sphere.rotateY(0.01);
					renderer.render( scene, camera );
				};

				
				animate();
			};
			window.onload = init;


		</script>
	</body>
</html>
